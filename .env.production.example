# ============================================================================
# Meta Chat Platform - Production Environment Configuration
# ============================================================================
#
# SECURITY NOTICE:
# - Never commit the actual .env.production file to version control
# - Use strong, randomly generated secrets for all keys
# - Rotate secrets regularly (at least every 90 days)
# - Store backups of this file in a secure password manager
#
# Setup Instructions:
# 1. Copy this file: cp .env.production.example .env.production
# 2. Generate secure secrets: node scripts/generate-secrets.js
# 3. Update all placeholder values with real credentials
# 4. Set restrictive permissions: chmod 600 .env.production
# ============================================================================

# ============================================================================
# Node Environment
# ============================================================================
NODE_ENV="production"
PORT="3000"
API_URL="https://chat.genai.hr"

# ============================================================================
# Database (PostgreSQL)
# ============================================================================
# Production database with connection pooling
# Format: postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=public&connection_limit=20&pool_timeout=30
DATABASE_URL="postgresql://metachat_user:CHANGE_ME_STRONG_PASSWORD@localhost:5432/metachat_prod?schema=public&connection_limit=20&pool_timeout=30"

# Database backup settings (used by backup scripts)
DB_BACKUP_ENABLED="true"
DB_BACKUP_RETENTION_DAYS="30"
DB_BACKUP_SCHEDULE="0 2 * * *"  # Daily at 2 AM
DB_BACKUP_PATH="/var/backups/metachat"
DB_BACKUP_S3_BUCKET=""  # Optional: S3 bucket for offsite backups
DB_BACKUP_S3_REGION=""  # Optional: AWS region

# ============================================================================
# Redis (Session Store & Cache)
# ============================================================================
# Production Redis with password authentication
# Format: redis://[:PASSWORD@]HOST:PORT[/DB]
REDIS_URL="redis://:CHANGE_ME_REDIS_PASSWORD@localhost:6379/0"
REDIS_MAX_RETRIES="3"
REDIS_RETRY_DELAY_MS="1000"

# ============================================================================
# RabbitMQ (Message Queue)
# ============================================================================
# Production RabbitMQ with authentication
# Format: amqp://USER:PASSWORD@HOST:PORT/VHOST
RABBITMQ_URL="amqp://metachat:CHANGE_ME_RABBITMQ_PASSWORD@localhost:5672/metachat"
RABBITMQ_HEARTBEAT="60"
RABBITMQ_PREFETCH="10"

# ============================================================================
# LLM Configuration
# ============================================================================

# Default LLM provider: openai | anthropic | ollama
LLM_PROVIDER="openai"

# --- OpenAI Configuration ---
OPENAI_API_KEY="sk-proj-CHANGE_ME_REAL_OPENAI_KEY"
OPENAI_MODEL="gpt-4o"
OPENAI_EMBEDDING_MODEL="text-embedding-3-small"
OPENAI_ORG_ID=""  # Optional: for organization tracking
OPENAI_MAX_RETRIES="3"
OPENAI_TIMEOUT="60000"

# --- Anthropic Configuration (Claude) ---
ANTHROPIC_API_KEY="sk-ant-api03-CHANGE_ME_REAL_ANTHROPIC_KEY"
ANTHROPIC_MODEL="claude-3-5-sonnet-20241022"
ANTHROPIC_MAX_RETRIES="3"
ANTHROPIC_TIMEOUT="60000"

# --- Ollama Configuration (Optional: Local Models) ---
OLLAMA_BASE_URL="http://localhost:11434"
OLLAMA_MODEL="llama3.1:8b"
OLLAMA_TIMEOUT="120000"

# --- LLM Parameters (Global Defaults) ---
LLM_TEMPERATURE="0.7"
LLM_MAX_TOKENS="1000"
LLM_TIMEOUT="30000"
LLM_MAX_RETRIES="3"

# --- Embeddings Configuration ---
EMBEDDINGS_PROVIDER="openai"
EMBEDDINGS_MODEL="text-embedding-3-small"
EMBEDDINGS_DIMENSIONS="1536"
EMBEDDINGS_BATCH_SIZE="100"

# ============================================================================
# Security & Encryption
# ============================================================================

# Encryption key for sensitive data at rest (32+ characters, base64 recommended)
# Generate with: openssl rand -base64 32
ENCRYPTION_KEY="CHANGE_ME_32_CHAR_ENCRYPTION_KEY_BASE64_ENCODED_RECOMMENDED"

# Admin JWT configuration
# Generate with: openssl rand -base64 64
ADMIN_JWT_SECRET="CHANGE_ME_64_CHARACTER_JWT_SECRET_RANDOM_STRING_HERE"
ADMIN_JWT_TTL_SECONDS="900"  # 15 minutes (short-lived for security)
ADMIN_JWT_AUDIENCE="admin"
ADMIN_JWT_ISSUER="meta-chat-api"
ADMIN_JWT_DEFAULT_SCOPE="admin:read"

# Optional: Additional pepper for admin key hashing
# Generate with: openssl rand -hex 32
ADMIN_KEY_PEPPER="CHANGE_ME_OPTIONAL_PEPPER_HEX_64_CHARS"

# WebChat authentication (for Socket.IO)
WEBCHAT_JWT_SECRET="CHANGE_ME_WEBCHAT_JWT_SECRET_64_CHARS"
WEBCHAT_HMAC_SECRET="CHANGE_ME_WEBCHAT_HMAC_SECRET_64_CHARS"

# ============================================================================
# API Security
# ============================================================================

# Rate limiting (per IP address)
API_RATE_LIMIT_WINDOW_MS="60000"  # 1 minute window
API_RATE_LIMIT_MAX="120"  # 120 requests per minute
API_BODY_LIMIT="5mb"  # Maximum request body size

# CORS configuration (comma-separated origins)
API_CORS_ORIGINS="https://chat.genai.hr,https://www.chat.genai.hr,https://dashboard.chat.genai.hr"

# Trusted proxy configuration (for proper IP detection behind load balancers)
TRUST_PROXY="true"
PROXY_IP_HEADER="x-forwarded-for"

# ============================================================================
# File Storage
# ============================================================================

STORAGE_PATH="/var/lib/metachat/storage"
STORAGE_MAX_FILE_SIZE="52428800"  # 50MB in bytes
STORAGE_ALLOWED_MIME_TYPES="application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain,text/markdown"

# Optional: S3-compatible storage for document uploads
S3_ENABLED="false"
S3_ENDPOINT=""
S3_BUCKET=""
S3_REGION=""
S3_ACCESS_KEY_ID=""
S3_SECRET_ACCESS_KEY=""

# ============================================================================
# Webhooks
# ============================================================================

WEBHOOK_RETRY_MAX_ATTEMPTS="5"
WEBHOOK_RETRY_INITIAL_DELAY_MS="1000"
WEBHOOK_RETRY_MAX_DELAY_MS="60000"
WEBHOOK_RETRY_BACKOFF_FACTOR="2"
WEBHOOK_TIMEOUT_MS="10000"

# ============================================================================
# Logging
# ============================================================================

LOG_LEVEL="info"  # error | warn | info | debug
LOG_FORMAT="json"  # json | pretty
LOG_DESTINATION="stdout"  # stdout | file | both
LOG_FILE_PATH="/var/log/metachat/app.log"
LOG_MAX_FILES="10"
LOG_MAX_SIZE="100m"

# Structured logging
LOG_INCLUDE_TIMESTAMP="true"
LOG_INCLUDE_HOSTNAME="true"
LOG_REDACT_SECRETS="true"

# ============================================================================
# Monitoring & Observability
# ============================================================================

# Prometheus metrics
METRICS_ENABLED="true"
METRICS_PORT="9090"
METRICS_PATH="/metrics"

# Health check configuration
HEALTH_CHECK_TIMEOUT_MS="5000"
HEALTH_CHECK_INCLUDE_DETAILS="false"  # Don't expose internal details in prod

# APM / Error Tracking (Optional)
SENTRY_DSN=""  # Optional: Sentry error tracking
SENTRY_ENVIRONMENT="production"
SENTRY_TRACES_SAMPLE_RATE="0.1"  # 10% of transactions

# ============================================================================
# Performance & Resource Limits
# ============================================================================

# Node.js runtime
NODE_OPTIONS="--max-old-space-size=4096 --max-http-header-size=16384"

# Database connection pool
DB_POOL_MIN="2"
DB_POOL_MAX="20"
DB_POOL_IDLE_TIMEOUT_MS="10000"
DB_POOL_ACQUIRE_TIMEOUT_MS="60000"

# Worker configuration
WORKER_CONCURRENCY="5"
WORKER_MAX_JOBS_PER_WORKER="100"
WORKER_JOB_TIMEOUT_MS="300000"  # 5 minutes

# ============================================================================
# Cost Tracking & Alerts
# ============================================================================

ENABLE_COST_TRACKING="true"
COST_ALERT_THRESHOLD="100"  # Alert if daily cost exceeds $100 USD
COST_ALERT_EMAIL=""  # Optional: email for cost alerts
COST_ALERT_WEBHOOK=""  # Optional: webhook for cost alerts

# ============================================================================
# Feature Flags
# ============================================================================

FEATURE_RAG_ENABLED="true"
FEATURE_FUNCTION_CALLING="true"
FEATURE_STREAMING="true"
FEATURE_MULTI_LANGUAGE="true"
FEATURE_ANALYTICS="true"

# ============================================================================
# Email Configuration (Optional)
# ============================================================================

SMTP_ENABLED="false"
SMTP_HOST=""
SMTP_PORT="587"
SMTP_SECURE="true"  # Use TLS
SMTP_USER=""
SMTP_PASSWORD=""
SMTP_FROM_EMAIL="noreply@chat.genai.hr"
SMTP_FROM_NAME="Meta Chat Platform"

# ============================================================================
# Maintenance Mode
# ============================================================================

MAINTENANCE_MODE="false"
MAINTENANCE_MESSAGE="The platform is currently undergoing maintenance. Please try again later."
MAINTENANCE_ALLOWED_IPS=""  # Comma-separated list of IPs that bypass maintenance mode

# ============================================================================
# Deployment Metadata (Auto-populated by CI/CD)
# ============================================================================

DEPLOY_VERSION=""  # Git commit SHA or version tag
DEPLOY_TIMESTAMP=""  # ISO 8601 timestamp
DEPLOY_ENVIRONMENT="production"
