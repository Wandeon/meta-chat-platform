# ============================================================================
# Meta Chat Platform API - Production Environment Configuration
# ============================================================================
# This file documents all environment variables required for production deployment.
# Copy this file to .env.production and fill in your actual values.
#
# SECURITY WARNING: Never commit .env.production to version control!
# It contains sensitive credentials and secrets.
# ============================================================================

# ============= Core Service Configuration =============
# Application environment (REQUIRED)
NODE_ENV=production

# Port the API server will listen on (REQUIRED)
# Default: 3000 (PM2 config may override to 3007)
PORT=3000

# Public-facing API URL (REQUIRED)
# This is the URL where the API is accessible from the internet
API_URL=https://chat.example.com

# ============= Storage Configuration =============
# Path for file storage (REQUIRED)
# Used for storing uploaded files, chat attachments, etc.
STORAGE_PATH=/app/storage

# ============= Database Configuration =============
# PostgreSQL connection string (REQUIRED)
# Format: postgresql://username:password@host:port/database?schema=public
# Example: postgresql://user:pass@localhost:5432/metachat?schema=public
DATABASE_URL=postgresql://username:password@localhost:5432/metachat?schema=public

# ============= Redis Configuration =============
# Redis connection URL (REQUIRED)
# Used for caching, session storage, and real-time features
# Format: redis://host:port/db
REDIS_URL=redis://localhost:6379/0

# ============= RabbitMQ Configuration =============
# RabbitMQ connection URL (REQUIRED)
# Used for message queuing between API and worker processes
# Format: amqp://username:password@host:port
# Note: Special characters in password must be URL-encoded (%25 for %, %23 for #, etc.)
RABBITMQ_URL=amqp://username:password@localhost:5672

# ============= Authentication & Security =============
# JWT secret for admin authentication (REQUIRED)
# Generate with: openssl rand -base64 64
# CRITICAL: Keep this secret! If compromised, all admin sessions are at risk.
ADMIN_JWT_SECRET=your-64-character-base64-secret-here

# JWT token time-to-live in seconds (REQUIRED)
# Default: 900 (15 minutes)
ADMIN_JWT_TTL_SECONDS=900

# JWT audience claim (REQUIRED)
# Identifies the intended recipient of the JWT
ADMIN_JWT_AUDIENCE=admin

# JWT issuer claim (REQUIRED)
# Identifies the service that issued the JWT
ADMIN_JWT_ISSUER=meta-chat-api

# Default JWT scope (REQUIRED)
# Default permission scope for admin tokens
ADMIN_JWT_DEFAULT_SCOPE=admin:read

# Admin key pepper for additional password hashing (REQUIRED)
# Generate with: openssl rand -hex 32
# Used to add extra security layer to password hashing
ADMIN_KEY_PEPPER=your-64-character-hex-pepper-here

# Encryption key for sensitive data (REQUIRED)
# Generate with: openssl rand -base64 32
# Used to encrypt sensitive data in the database (e.g., API keys)
ENCRYPTION_KEY=your-32-character-base64-key-here

# Global API key for system-level access (OPTIONAL)
# Leave empty if not using global API key authentication
GLOBAL_API_KEY=

# ============= LLM Provider Configuration =============
# Default LLM provider (REQUIRED)
# Options: openai, anthropic, etc.
LLM_PROVIDER=openai

# OpenAI model for chat completions (REQUIRED if using OpenAI)
# Examples: gpt-4o, gpt-4-turbo, gpt-3.5-turbo
OPENAI_MODEL=gpt-4o

# OpenAI embedding model (REQUIRED if using OpenAI embeddings)
# Examples: text-embedding-3-small, text-embedding-3-large
OPENAI_EMBEDDING_MODEL=text-embedding-3-small

# OpenAI API key (REQUIRED if using OpenAI)
# Get from: https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-your-openai-api-key-here

# OpenAI organization ID (OPTIONAL)
# Only needed if you belong to multiple organizations
OPENAI_ORG_ID=

# ============= Observability & Monitoring =============
# Log level for application logging (REQUIRED)
# Options: error, warn, info, debug, trace
LOG_LEVEL=info

# Enable cost tracking for LLM usage (REQUIRED)
# Set to true to track API costs
ENABLE_COST_TRACKING=true

# Cost alert threshold in USD (REQUIRED if cost tracking enabled)
# Alert when daily costs exceed this amount
COST_ALERT_THRESHOLD=100

# ============= Rate Limiting Configuration =============
# Rate limit window in milliseconds (REQUIRED)
# Default: 60000 (1 minute)
RATE_LIMIT_WINDOW_MS=60000

# Maximum requests per window (REQUIRED)
# Default: 100 requests per minute
RATE_LIMIT_MAX_REQUESTS=100

# ============= Webhook Configuration =============
# Maximum retry attempts for failed webhooks (REQUIRED)
# Default: 5
WEBHOOK_RETRY_MAX_ATTEMPTS=5

# Initial delay between webhook retries in milliseconds (REQUIRED)
# Default: 1000 (1 second)
# Subsequent retries use exponential backoff
WEBHOOK_RETRY_INITIAL_DELAY_MS=1000

# ============= CORS Configuration =============
# CRITICAL SECURITY: Allowed origins for cross-origin requests (REQUIRED)
# Comma-separated list of URLs that can make requests to the API
# This prevents unauthorized websites from accessing your API
# Example: https://chat.example.com,https://www.chat.example.com
API_CORS_ORIGINS=https://chat.example.com

# ============= Health Check Configuration =============
# Health check cache TTL in milliseconds (OPTIONAL)
# Default: 3000 (3 seconds)
# Prevents health check endpoint from overwhelming the system
HEALTH_CHECK_CACHE_TTL_MS=3000

# ============= Telegram Monitoring (OPTIONAL) =============
# Telegram bot token for sending alerts (OPTIONAL)
# Get from: https://t.me/BotFather
# Uncomment to enable Telegram alerts
#TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz

# Telegram chat ID to receive alerts (OPTIONAL)
# Get by messaging @userinfobot on Telegram
# Uncomment to enable Telegram alerts
#TELEGRAM_CHAT_ID=123456789

# ============= Email Alerts (OPTIONAL) =============
# Email address to receive system alerts (OPTIONAL)
# Uncomment to enable email alerts
#ALERT_EMAIL=admin@example.com

# ============= SMTP Configuration =============
# SMTP server hostname (REQUIRED for email features)
# Examples:
#   Gmail: smtp.gmail.com
#   SendGrid: smtp.sendgrid.net
#   AWS SES: email-smtp.us-east-1.amazonaws.com
SMTP_HOST=smtp.gmail.com

# SMTP server port (REQUIRED for email features)
# Common ports: 587 (TLS), 465 (SSL), 25 (unencrypted)
SMTP_PORT=587

# Use SSL/TLS for SMTP connection (REQUIRED for email features)
# Set to false for STARTTLS (port 587), true for SSL (port 465)
SMTP_SECURE=false

# SMTP username (REQUIRED for email features)
# Gmail: your-email@gmail.com
# SendGrid: apikey (literal string "apikey")
# AWS SES: Your IAM SMTP username
SMTP_USER=your-email@gmail.com

# SMTP password or API key (REQUIRED for email features)
# Gmail: App-specific password (not your regular password)
#   Generate at: https://myaccount.google.com/apppasswords
# SendGrid: Your SendGrid API key
# AWS SES: Your IAM SMTP password
SMTP_PASS=xxxx xxxx xxxx xxxx

# From email address (REQUIRED for email features)
# This is the sender address for all outgoing emails
FROM_EMAIL=noreply@example.com

# Base URL for email links (REQUIRED for email features)
# Used to generate links in emails (e.g., password reset links)
BASE_URL=https://chat.example.com

# ============= Payment Processing (OPTIONAL) =============
# Stripe secret key (REQUIRED if using Stripe payments)
# Get from: https://dashboard.stripe.com/apikeys
# Uncomment to enable Stripe payments
#STRIPE_SECRET_KEY=sk_live_your_stripe_secret_key

# Stripe publishable key (REQUIRED if using Stripe payments)
# Uncomment to enable Stripe payments
#STRIPE_PUBLISHABLE_KEY=pk_live_your_stripe_publishable_key

# Stripe webhook secret (REQUIRED if using Stripe webhooks)
# Get from: https://dashboard.stripe.com/webhooks
# Uncomment to enable Stripe webhooks
#STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret

# Stripe price IDs for subscription tiers (REQUIRED if using Stripe)
# Get from: https://dashboard.stripe.com/prices
# Uncomment to enable Stripe subscriptions
#STRIPE_PRICE_STARTER=price_starter_plan_id
#STRIPE_PRICE_PRO=price_pro_plan_id

# Stripe redirect URLs (REQUIRED if using Stripe)
# URLs to redirect users after payment success/cancellation
# Uncomment to enable Stripe subscriptions
#STRIPE_SUCCESS_URL=https://chat.example.com/billing/success
#STRIPE_CANCEL_URL=https://chat.example.com/billing

# ============================================================================
# SMTP Provider Examples (Choose ONE and configure accordingly)
# ============================================================================

# --- Gmail Configuration ---
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_SECURE=false
# SMTP_USER=your-email@gmail.com
# SMTP_PASS=xxxx xxxx xxxx xxxx  # App-specific password
# FROM_EMAIL=your-email@gmail.com

# --- SendGrid Configuration ---
# SMTP_HOST=smtp.sendgrid.net
# SMTP_PORT=587
# SMTP_SECURE=false
# SMTP_USER=apikey  # Literal string "apikey"
# SMTP_PASS=SG.your_sendgrid_api_key_here
# FROM_EMAIL=noreply@example.com

# --- AWS SES Configuration ---
# SMTP_HOST=email-smtp.us-east-1.amazonaws.com  # Region-specific
# SMTP_PORT=587
# SMTP_SECURE=false
# SMTP_USER=your-ses-smtp-username
# SMTP_PASS=your-ses-smtp-password
# FROM_EMAIL=noreply@example.com

# ============================================================================
# Variable Summary by PM2 Usage
# ============================================================================
# The following variables are explicitly used by PM2 (ecosystem.config.js):
# - NODE_ENV (required)
# - PORT (required)
# - DATABASE_URL (required)
# - REDIS_URL (required)
# - RABBITMQ_URL (required)
# - ADMIN_JWT_SECRET (required)
# - ADMIN_KEY_PEPPER (required)
# - ENCRYPTION_KEY (required)
# - API_CORS_ORIGINS (required)
# - SMTP_* variables (required for email features)
# - STRIPE_* variables (optional, for payments)
#
# All other variables are loaded directly by the application.
# ============================================================================

# ============================================================================
# Security Checklist Before Deployment
# ============================================================================
# [ ] All *_SECRET and *_KEY variables contain strong, randomly generated values
# [ ] Database credentials use strong passwords
# [ ] ADMIN_JWT_SECRET is at least 64 characters
# [ ] ENCRYPTION_KEY is properly generated (32 bytes, base64-encoded)
# [ ] API_CORS_ORIGINS contains only your trusted domains
# [ ] SMTP credentials are configured for production email provider
# [ ] .env.production is NOT committed to version control
# [ ] File permissions are set to 600 (chmod 600 .env.production)
# [ ] OpenAI API key has appropriate rate limits and spending caps
# [ ] All placeholder values have been replaced with real values
# ============================================================================
